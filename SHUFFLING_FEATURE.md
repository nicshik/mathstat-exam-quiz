# Функция перемешивания ответов

**Дата добавления:** 25 декабря 2025 г.

## Описание

Теперь варианты ответов перемешиваются случайным образом при каждом загрузке вопроса. Это означает, что:

- ✓ Правильный ответ больше НЕ всегда первый вариант (А)
- ✓ Каждый раз вариант в разных позициях
- ✓ JSON не требует изменений — перемешивание на уровне JS
- ✓ Студенты должны понимать вопрос, а не угадывать паттерн

---

## Как это работает

### Алгоритм

1. **Загрузка вопроса** → в `showQuestion()`
2. **Fisher-Yates shuffle** → функция `shuffleArray()`
   ```javascript
   // Оригинальные варианты: [A, B, C, D]
   // Перемешанные:        [C, A, D, B]
   ```
3. **Маппинг индексов** → `createIndexMapping()`
   ```
   Оригинальный индекс → Новый индекс
   0 (A) → 1
   1 (B) → 3
   2 (C) → 0
   3 (D) → 2
   ```
4. **Проверка ответа** → в `handleAnswer()`
   - Студент кликает на вариант в позиции 0 (видит "C")
   - Проверяем: соответствует ли это правильному ответу в перемешанном массиве
   - Результат отображается корректно

---

## Реализованные функции

### `shuffleArray(array)`
Перемешивает массив используя алгоритм Fisher-Yates (в-место).

```javascript
const options = ['A', 'B', 'C', 'D'];
const shuffled = shuffleArray(options);
// Результат: ['D', 'A', 'B', 'C'] или другой случайный порядок
```

**Преимущества Fisher-Yates:**
- Равномерное распределение перестановок
- O(n) сложность
- Стандарт индустрии

### `createIndexMapping(originalArray, shuffledArray)`
Создает маппинг для отслеживания, куда переместились элементы.

```javascript
const original = ['Вариант A', 'Вариант B', 'Вариант C'];
const shuffled = ['Вариант C', 'Вариант A', 'Вариант B'];
const mapping = createIndexMapping(original, shuffled);
// mapping = { 0: 1, 1: 2, 2: 0 }
// Оригинальный индекс 0 → новый индекс 1 (там теперь 'A')
```

---

## Структура состояния

### `shuffledOptionsMap`
Общий объект для отслеживания перемешивания:

```javascript
{
  "1.1": {  // question ID
    originalCorrect: 0,           // Индекс в оригинальном quizData.json
    mapping: { 0: 2, 1: 0, 2: 1, 3: 3 },  // Маппинг индексов
    shuffledCorrect: 2            // Где оказался правильный ответ
  },
  "1.2": {
    originalCorrect: 0,
    mapping: { 0: 3, 1: 1, 2: 0, 3: 2 },
    shuffledCorrect: 3
  }
}
```

---

## Изменения в коде

### Новые переменные
- `shuffledOptionsMap` — отслеживает перемешивание для каждого вопроса

### Модифицированные функции

#### `startQuiz(taskId)`
```javascript
shuffledOptionsMap = {}; // Сброс для новой попытки
```

#### `showQuestion()`
```javascript
// SHUFFLE OPTIONS
const originalOptions = question.options;
const shuffledOptions = shuffleArray(originalOptions);
const indexMapping = createIndexMapping(originalOptions, shuffledOptions);

shuffledOptionsMap[question.id] = {
    originalCorrect: question.correct,
    mapping: indexMapping,
    shuffledCorrect: indexMapping[question.correct]
};

// Теперь используем shuffledOptions для отображения
${shuffledOptions.map((opt, idx) => `...`)}
```

#### `handleAnswer(btn, question, shuffledOptions)`
```javascript
const selectedIndex = parseInt(btn.dataset.index); // Индекс в ПЕРЕМЕШАННОМ массиве
const questionMeta = shuffledOptionsMap[question.id];
const correctShuffledIndex = questionMeta.shuffledCorrect;
const isCorrect = selectedIndex === correctShuffledIndex; // Сравниваем в перемешанном пространстве
```

---

## Тестирование

### Проверка 1: Случайность
```javascript
// Откройте консоль (F12)
// Пройдите вопрос несколько раз
// Проверьте: варианты в разных порядках
console.log(shuffledOptionsMap);
```

### Проверка 2: Корректность
```javascript
// Выберите вариант, который ВЫГЛЯДИТ как первый вариант quizData.json
// Если это правильный ответ — система должна одобрить
// Если неправильный — показать ошибку
```

### Проверка 3: Хранение ответов
```javascript
// На странице результатов проверьте:
// "Ваш ответ: В. [текст варианта]"
// Вариант должен СОВПАДАТЬ с тем, что вы выбрали (даже если буква изменилась)
```

---

## Примеры

### Пример 1: Вопрос 1.1
**Оригинальные варианты (quizData.json):**
```
A. Попарная несовместимость и полнота (сумма вероятностей = 1)  [CORRECT]
B. Только попарная несовместимость
C. Только полнота (сумма = 1)
D. Независимость событий
```

**На экране (первый проход):**
```
А. Только полнота (сумма = 1)
Б. Независимость событий
В. Попарная несовместимость и полнота (сумма вероятностей = 1)  [CORRECT]
Г. Только попарная несовместимость
```

**На экране (второй проход):**
```
А. Независимость событий
Б. Только попарная несовместимость
В. Только полнота (сумма = 1)
Г. Попарная несовместимость и полнота (сумма вероятностей = 1)  [CORRECT]
```

---

## FAQ

**Q: Нужно ли менять JSON?**
А: НЕТ. JSON остается без изменений. Перемешивание происходит только в памяти браузера.

**Q: Что если я буду часто перезагружать страницу?**
А: Каждый раз варианты будут в новом порядке — это нормально. Это задача.

**Q: Можно ли отключить перемешивание?**
А: Да, закомментируйте строки с `shuffleArray()` в `showQuestion()`. Но это нарушит смысл функции.

**Q: Влияет ли перемешивание на результаты?**
А: НЕТ. Результаты и объяснения остаются теми же. Меняется только визуальный порядок.

---

## Производительность

- **Fisher-Yates:** O(n) — пренебрежимо мало (n=4 опции)
- **Маппинг:** O(n) — тоже пренебрежимо
- **Общее время на вопрос:** <1ms

---

## Совместимость

- ✓ Все браузеры (Chrome, Firefox, Safari, Edge)
- ✓ Mobile (iOS, Android)
- ✓ Node.js (если понадобится экспортировать функции)

---

## История изменений

| Дата | Изменение |
|------|----------|
| 2025-12-25 | Добавлена функция перемешивания ответов |