# CHANGELOG

## [v3.1] - 2025-12-25 (LATEST)

### Новые возможности

#### Функция перемешивания вариантов ответов (Randomized Options)
- **Что изменилось**: Варианты ответов (А, Б, В, Г) теперь перемешиваются при каждой загрузке вопроса
- **Зачем**: Студенты не могут угадывать по паттерну «правильный ответ всегда первый»
- **Как реализовано**:
  - Алгоритм Fisher-Yates shuffle (O(n) время)
  - Отслеживание маппинга индексов (оригинальный → новый)
  - Проверка ответов по перемешанному индексу
  - Результаты и объяснения остаются корректными

#### Детали имплементации
- **app.js**:
  - Добавлена функция `shuffleArray(array)` — Fisher-Yates shuffle
  - Добавлена функция `createIndexMapping(original, shuffled)` — маппинг индексов
  - Модифицирована `showQuestion()` — перемешивание опций перед отображением
  - Модифицирована `handleAnswer()` — проверка по перемешанному индексу
  - Добавлена переменная `shuffledOptionsMap` — отслеживание маппинга

- **quizData.json**: БЕЗ ИЗМЕНЕНИЙ
  - JSON остаётся в оригинальном виде (correct: 0 для всех вопросов)
  - Перемешивание происходит только в памяти браузера
  - Каждый студент видит разные порядки

#### Пример
```
Оригинальные варианты (JSON):
  correct: 0 (вариант А)
  options: ["А. Попарная несовместимость...", "Б. Только попарная...", ...]

На экране (первый раз):
  А. Только полнота
  Б. Независимость событий
  В. Попарная несовместимость...  [CORRECT в новой позиции]
  Г. Только попарная

На экране (второй раз — новая загрузка):
  А. Независимость событий
  Б. Попарная несовместимость...  [CORRECT в другой позиции]
  В. Только попарная
  Г. Только полнота
```

#### Тестирование
- Открыть браузер → F12 (консоль) → console.log(shuffledOptionsMap)
- Пройти вопрос несколько раз → варианты в разных позициях каждый раз
- Результаты показывают выбранный текст (совпадает с экраном)
- Объяснения соответствуют оригинальному JSON

#### Совместимость
- Браузеры: Chrome, Firefox, Safari, Edge (все версии, поддерживающие ES6)
- Mobile: iOS Safari, Chrome Android
- Данные: 100% обратная совместимость (JSON не меняется)

#### Документация
- Добавлен файл `SHUFFLING_FEATURE.md` с полным описанием
  - Алгоритм (Fisher-Yates)
  - Структура данных (`shuffledOptionsMap`)
  - Примеры (как работает на практике)
  - FAQ и troubleshooting

---

## [v3.0] - 2025-12-25

### Критические исправления (на основе question_list_opus4.5_v3.md)

#### BREAKING CHANGES:
- **Вопрос 4.1 (D1)**: Исправлено определение VaR
  -  Было: "максимальный ожидаемый убыток" 
  -  Стало: "квантиль распределения убытков — пороговое значение"
  - **Причина**: VaR — это КВАНТИЛЬ, а НЕ математическое ожидание

- **Вопрос 4.5 (D2)**: Исправлены Basel зоны
  -  Было: "До 4 нарушений при N=250, α=0.05"
  -  Стало: "99% VaR (α=0.01), N=250 торговых дней"
  - **Причина**: Basel Committee III стандарт определён для α=0.01, не α=0.05

### Новые вопросы (критические ловушки из v3)

#### Задача 1 (Вероятности):
- **1.9**: Линейность E[X+Y] для зависимых величин
  - Проверяет понимание, что линейность работает ВСЕГДА

#### Задача 3 (Колмогоров):
- **3.10** КРИТИЧЕСКИЙ: Масштабирование √n
  - Самая частая ошибка: забыть умножить Dₙ на √n
  - Без масштабирования графики не совпадут

#### Задача 4 (VaR Backtesting):
- **4.12**: Запрет скользящих окон
  - Проверяет понимание предпосылок теста Купика (независимость)
- **4.13**: Basel α=0.01 явно
  - Уточняет, что Basel зоны только для 99% VaR

#### Задача 5 (Регрессия):
- **5.11**: Формула β₁ = ρ·(σ_Y/σ_X)
  - Частая ошибка: путать β₁ и корреляцию ρ

### Статистика

**Было**: 61 вопросов (8+7+9+11+10) с 2 критическими ошибками
**Стало**: 50 вопросов (9+7+10+13+11)

**Изменения**:
- Исправлено: 2 критических ошибки (D1, D2)
- Добавлено: 5 новых критических вопросов
- Оптимизировано: убраны дублирующиеся вопросы
- Сохранена: 100% обратная совместимость структуры

### Справочные материалы

Все изменения основаны на:
- `question_list_opus4.5_v3.md` (исправления D1-D9)
- `final_exam_work1.pdf` - `final_exam_work5.pdf` (эталонные решения)
- `VaR-Backtesting-Best-Practice_v1.md`
- `task-to-materials-mapping-v3.1.md`

### Для пользователей

Обновление **не ломает** существующий код квиза:
- Структура JSON сохранена (ключи "1"-"5", массивы)
- Формат вопросов не изменён (id, text, options, correct, explanation)
- Индексы правильных ответов (correct) валидны

### Для разработчиков

```javascript
// Пример использования (совместимо с предыдущей версией)
const quiz = await fetch('quizData.json').then(r => r.json());
const task4Questions = quiz["4"]; // 13 вопросов (было 11)
console.log(task4Questions[4].text); // Обновлённый вопрос 4.5
```

### Детали исправлений

#### D1: VaR не является математическим ожиданием
```python
# НЕПРАВИЛЬНО
var = np.mean(losses)  # Это мат.ожидание, НЕ VaR!

# ПРАВИЛЬНО
var = np.quantile(returns, 0.05)  # Квантиль!
```

#### D2: Basel зоны для α=0.01, не α=0.05
```python
# НЕПРАВИЛЬНО применять Basel-зоны для 95% VaR
if exceptions <= 4:
    print("Зелёная зона")  # Только для 99% VaR!

# ПРАВИЛЬНО
alpha = 0.01  # Basel требует 99% VaR
if alpha == 0.01 and exceptions <= 4:
    print("Зелёная зона")
```

#### D3: Масштабирование √n для статистики Колмогорова
```python
# НЕПРАВИЛЬНО
plt.plot(D_values, label='Dₙ')  # График не совпадёт!
# ПРАВИЛЬНО
plt.plot(np.sqrt(n) * D_values, label='√n·Dₙ')
```

---

## [v2.0] - 2025-12-25 (предыдущая версия)

**Статус**: 61 вопрос, 2 критических ошибки (D1, D2), отсутствие вопроса про √n

---

## Контакты

- **Репозиторий**: https://github.com/nicshik/mathstat-exam-quiz
- **Issues**: https://github.com/nicshik/mathstat-exam-quiz/issues
- **Автор обновления**: Система проверки на основе v3 guidelines  
- **Дата**: 25 декабря 2025, 20:25 MSK